[id="assembly_adding_ocp_sources"]
= Adding an OpenShift Container Platform source to Cost Management

This section describes how to connect your OpenShift Container Platform cluster to the Cost Management application.

////
Adding a source
-> Adding an OpenShift source
----> Configuring your OpenShift cluster
-------> Create an S3 bucket
-------> Configure IAM
-------> Configure SNS notifications
----> Adding the OpenShift cluster to Cost Management
////


To add an OpenShift Container Platform account to Cost Management, you must configure your OpenShift cluster to provide operator metering usage data, then add the source in the Cost Management user interface.

== Configuring your OpenShift Container Platform cluster

//Should this section be its own assembly with the 3 topics? Then link the last procedure with an include...)

Before you can add your OpenShift cluster to Cost Management for monitoring, you must configure your OpenShift Container Platform account to allow Cost Management access to metrics.


=== Prerequisites
//What kind of module does this go into?
// Add links to other docs that show you how to install these.

To obtain the OpenShift operator metering usage data, Cost Management requires the following prerequisites installed:

*On your OpenShift cluster*

* OpenShift Container Platform 3.11 or newer
* Operator Metering
* The Operator Metering installation must expose a route for the reporting operator. See https://github.com/operator-framework/operator-metering/blob/master/Documentation/configuring-reporting-operator.md#openshift-route for instructions on exposing a route.

*On a system with network access to your OpenShift cluster*

* Red Hat Insights Client
* Ansible and EPEL repositories
* OpenShift command line tools (oc)

For your OpenShift Container Platform cluster to provide metrics to Cost Management:

//ADD LINKS TO PROCEDURE TOPICS - this is a preview list//
. Obtain a login token for your metering-operator service account.
. Download and configure the Usage Collector Ansible playbook to generate report resources for your OpenShift cluster.
. Create a cron job to regularly collect and send operator metering usage data to the upload service.


include::modules/proc_obtaining_operator_metering_login.adoc[]

include::modules/proc_downloading_and_configuring_usage_collector.adoc[]

include::modules/proc_uploading_data_with_usage_collector.adoc[]

include::modules/proc_adding_an_ocp_cluster.adoc[]

// This probably needs the title here - 'Adding your OpenShift Container Platform account as a source', but I've put the title in the proc topic. Where should it go?
// Adding an OpenShift Container Platform cluster as a source

You have completed adding your OpenShift Container Platform account as a source.
